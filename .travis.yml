language: node_js
os: linux
node_js:
  - 12

jobs:
  include:
    # - stage: testing
      # if: branch in (main, develop)
      # env:
      #   - FOO=foo
      # before_install: # before npm install
      #   - npm run before-install
      # before_script: # before running test
      #   - npm run before-script
      # script: # if this is not set, it will run npm run test 
      #   - npm install
      #   - npm run test
      # after_success: # after test is run
      #   - npm run after-success
      #   - mv coverage/coverage-final.json coverage/coverage.json
      #   - codecov
      # after_script: # after everything is run
      #   - ts-node ./afterScript.ts
    - stage: npm release
      # only release on main branch with specific commit message (generated by npm version)
      if: branch = main # AND commit_message =~ /^[0-9]*\.[0-9]*\.[0-9]*$/
      before_deploy:
      - npm install
      deploy:
        edge: true
        provider: npm
        email: "$NPM_EMAIL"
        api_key: "$NPM_TOKEN"
        cleanup: true